#include QMK_KEYBOARD_H
#include "layers.h"

#ifdef OLED_ENABLE

static void render_logo(void) {
    // image is 32x128 rotated right
    static const char PROGMEM raw_logo[] = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x40, 0x80, 0x50, 0x20, 0x70, 0x20, 0x50, 0x00, 0x54, 0x08, 0x54, 0x08,
        0x54, 0x08, 0x54, 0x08, 0x54, 0x08, 0x54, 0x20, 0x71, 0x22, 0x51, 0x80, 0x55, 0x8a, 0x55, 0x20,
        0x55, 0x2a, 0x55, 0x08, 0x55, 0x00, 0x55, 0xaa, 0x55, 0x80, 0x40, 0x80, 0x75, 0x2a, 0x55, 0x00,
        0x55, 0xaa, 0x55, 0x88, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x10, 0x2a, 0x54, 0x08, 0x55, 0x02, 0x55, 0x00, 0x55, 0x00, 0x55, 0x00, 0x55, 0x00, 0x05, 0x00,
        0x05, 0x80, 0x45, 0x80, 0x45, 0x80, 0x45, 0x00, 0x55, 0x00, 0x55, 0x08, 0x55, 0x2a, 0x55, 0x80,
        0x55, 0x20, 0x55, 0x00, 0x55, 0x02, 0x55, 0x0a, 0x55, 0x02, 0x55, 0x00, 0x55, 0xa0, 0x55, 0x08,
        0x55, 0xa2, 0x45, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x11, 0xaa, 0x55, 0x88, 0x55, 0x00, 0x55, 0x00, 0x55, 0x00, 0x55, 0x00, 0x55, 0x00, 0x45, 0x00,
        0x11, 0x08, 0x15, 0x08, 0x15, 0x08, 0x55, 0x00, 0x55, 0x00, 0x55, 0x00, 0x75, 0x20, 0x55, 0x0a,
        0x55, 0x02, 0x55, 0x80, 0x55, 0x80, 0x55, 0x08, 0x55, 0x20, 0x55, 0x00, 0x15, 0x88, 0x55, 0x20,
        0x75, 0xa0, 0x55, 0x80, 0x55, 0x2a, 0x54, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x01, 0x00, 0x01, 0x00, 0x05, 0x02, 0x15, 0x08, 0x15, 0xa0, 0x55, 0x80, 0x55, 0xa0, 0x55, 0x80,
        0x55, 0xa0, 0x55, 0x80, 0x55, 0xa0, 0x55, 0x08, 0x15, 0x02, 0x05, 0x02, 0x75, 0xaa, 0x55, 0x0a,
        0x55, 0xaa, 0x55, 0xa8, 0x55, 0xa2, 0x55, 0x0a, 0x55, 0xaa, 0x55, 0xa8, 0x55, 0x02, 0x55, 0xaa,
        0x55, 0x00, 0x01, 0x00, 0x05, 0x02, 0x05, 0x02, 0x05, 0x20, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00
    };

    oled_write_raw_P(raw_logo, sizeof(raw_logo));
}

static void print_status_narrow(void) {
    // Print current mode
    oled_write_P(PSTR("\n\n"), false);
    oled_write_ln_P(PSTR("MODE"), false);
    oled_write_ln_P(PSTR(""), false);
    if (keymap_config.swap_lctl_lgui) {
        oled_write_ln_P(PSTR("MAC"), false);
    } else {
        oled_write_ln_P(PSTR("WIN"), false);
    }

    oled_write_P(PSTR("\n\n"), false);
    // Print current layer
    oled_write_ln_P(PSTR("LAYER"), false);
    switch (get_highest_layer(layer_state)) {
        case _QWERTY:
            oled_write_P(PSTR("Norm\n"), false);
            break;
        case _RAISE:
            oled_write_P(PSTR("Raise"), false);
            break;
        case _LOWER:
            oled_write_P(PSTR("Lower"), false);
            break;
        case _ADJUST:
            oled_write_P(PSTR("Adj\n"), false);
            break;
        default:
            oled_write_ln_P(PSTR("Undef"), false);
    }

    oled_write_P(PSTR("\n\n"), false);
    led_t led_usb_state = host_keyboard_led_state();
    oled_write_ln_P(PSTR("CPSLK\n\n"), led_usb_state.caps_lock);
    oled_write_P(PSTR("\n\n"), false);
}

oled_rotation_t oled_init_user(oled_rotation_t rotation) {
    return is_keyboard_master() ? OLED_ROTATION_270 : OLED_ROTATION_180;
}

bool oled_task_user(void) {
    if (is_keyboard_master()) {
        print_status_narrow();
    } else {
        render_logo();
        oled_scroll_left();
        oled_scroll_set_speed(4);
    }

    return false;
}

#endif
